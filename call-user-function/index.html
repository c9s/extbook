<!DOCTYPE html>
<html>
    <head>
        <title>calling user functions &mdash; PHP Extension Book &mdash; Extension Cookbook!</title>
        <meta charset="utf-8">
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <meta name="robots" content="index, follow">


        
        <link href="https://c9s.github.io/extbook/stylesheets/style.css" rel="stylesheet" type="text/css" />
        <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">

        <link rel="stylesheet" href="https://c9s.github.io/extbook/components/highlightjs/styles/github.css" />
        <link rel="alternate" type="application/atom+xml" href="https://c9s.github.io/extbook/atom.xml" title="PHP Extension Book activity feed" />
        <style>
        /** quick fix because bootstrap <pre> has a background-color. */
        pre code { background-color: inherit; }

        </style>
                                    </head>
    <body>

        <div class="container">

            <div class="row">

                <div class="col-md-9">

                        <article>
        <header>
            <h2>calling user functions <small>post</small></h2>
        </header>
        <div>
            <pre><code class="cpp"><br />// retval_ptr is used for the return value of the function call.
zval *retval_ptr;

// params for the function call.
zval ***params;

// just one parameter
int n_params = 1;

// status is used for detecting function call's return status 
int status;

// the function call (callback)
zval *cb_array;

if (!cb_array || !zend_is_callable(cb_array, IS_CALLABLE_CHECK_NO_ACCESS, NULL TSRMLS_CC)) {
    php_error_docref(NULL TSRMLS_CC, E_WARNING, "First argument is expected to be a valid callback");
    zval_dtor(value);
    Z_TYPE_P(value) = IS_NULL;
    return;
}

params = safe_emalloc(sizeof(zval **), n_params, 0);
params[0] = &amp;value;


// You can replace EG(function_table) with the function table of a class entry if you're calling a class method.
/* function table, object ptr, cb_array = callback, n_params, params */
status = call_user_function_ex(EG(function_table), NULL, cb_array, &amp;retval_ptr, n_params, params, 0, NULL TSRMLS_CC);

// free the params
efree(params);

// copy retval zval to the zval we need to use.
if (status == SUCCESS &amp;&amp; retval_ptr != NULL) {
    if (retval_ptr != value) {
        zval_dtor(value);
        COPY_PZVAL_TO_ZVAL(*value, retval_ptr);
    } else {
        zval_ptr_dtor(&amp;retval_ptr);
    }
} else {
    zval_dtor(value);
    Z_TYPE_P(value) = IS_NULL;
}

</code></pre>

        </div>
                
                    <nav class="article">
                <ul>
                                            <li>Next: <a class="next" href="https://c9s.github.io/extbook/parse-callable-parameter" title="Parse Callable Parameter"><span class="title">Parse Callable Parameter</span></a></li>
                                                                <li>Previous: <a class="previous" href="https://c9s.github.io/extbook/invalid-library" title="Extension Skeleton"><span class="title">Extension Skeleton</span></a></li>
                                    </ul>
            </nav>
            </article>




                </div>

                <div class="col-md-3 sidebar">

                    <h3>
                        <a href="https://c9s.github.io/extbook/">PHP Extension Book</a>
                    </h3>

                    <ul class="list-unstyled">
                        <li><a href="https://c9s.github.io/extbook/blog/categories">Categories</a></li>
                        <li><a href="https://c9s.github.io/extbook/blog/tags">Tags</a></li>
                        <li><a href="https://c9s.github.io/extbook/blog">Posts Archive</a></li>
                        <li><a href="https://c9s.github.io/extbook/about">About</a></li>
                    </ul>


                    <h4>Recent Posts</h4>

                    <ul class="list-unstyled">
                                            </ul>
                </div>

            </div>

            <div class="well">
                <h3>PHP Extension Book <small>Extension Cookbook!</small></h3>
            </div>

            <div class="well">
                                <h4>Powered By</h4>
                <ul class="list-unstyled">
                    <li><a href="http://sculpin.io">sculpin.io</a></li>
                    <li><a href="http://twitter.com/getsculpin">@getsculpin</a></li>
                </ul>
            </div>

            <footer>
                &copy; 2015 PHP Extension Book
            </footer>
        </div>


        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="https://c9s.github.io/extbook/components/jquery/jquery.min.js"><\/script>')</script>
                
                <script src="https://c9s.github.io/extbook/components/highlightjs/highlight.pack.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>

                    </body>
</html>
