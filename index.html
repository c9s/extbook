<!DOCTYPE html>
<html>
    <head>
        <title>Home &mdash; PHP Extension Book &mdash; Extension Cookbook!</title>
        <meta charset="utf-8">
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <meta name="robots" content="noindex, follow">
        

        
        <link href="https://c9s.github.io/extbook/stylesheets/style.css" rel="stylesheet" type="text/css" />
        <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">

        <link rel="stylesheet" href="https://c9s.github.io/extbook/components/highlightjs/styles/github.css" />
        <link rel="alternate" type="application/atom+xml" href="https://c9s.github.io/extbook/atom.xml" title="PHP Extension Book activity feed" />
        <style>
        /** quick fix because bootstrap <pre> has a background-color. */
        pre code { background-color: inherit; }

        </style>
                                    </head>
    <body>

        <div class="container">

            <div class="row">

                <div class="col-md-9">

                                            <article>
        <header>
            <h2><a href="https://c9s.github.io/extbook/args-info-object">Defining ARG_INFO for object parameters</a></h2>
        </header>
        <div>
            <pre><code class="cpp">// ZEND_ARG_OBJ_INFO(pass_by_ref, name, classname, allow_null)
ZEND_BEGIN_ARG_INFO_EX(arginfo_test, 0, 0, 3)
    ZEND_ARG_INFO(0, firstArg)
    ZEND_ARG_OBJ_INFO(0, objStdClassNonNull, stdClass, 0)
    ZEND_ARG_OBJ_INFO(0, objStdClass, stdClass, 1)
    ZEND_ARG_OBJ_INFO(1, objStdClassByRef, stdClass, 1)
ZEND_END_ARG_INFO()
</code></pre>

<p>The code above creates the following function prototype:</p>

<pre><code class="php"><br />function sample_with_types($firstArg, stdClass $objStdClassNonNull, stdClass $objStdClass = null, stdClass &amp; $objStdClassByRef) {
    // ...
}
</code></pre>

<p>It has the following effects:</p>

<pre><code class="cpp">sample_with_types();                          // ok
sample_with_types(1, null);                   // error: arg #2 should be stdClass
sample_with_types(1, new stdClass, null);     // ok
sample_with_types(1, new stdClass, 1);        // error: arg #3 should be stdClass
sample_with_types(1, new stdClass, null, 2);  // error: arg #4 must be reference
</code></pre>

        </div>
            </article>
    <article>
        <header>
            <h2><a href="https://c9s.github.io/extbook/args-info">Defining ARG_INFO</a></h2>
        </header>
        <div>
            <p>The code below presents: <code>($environment, $response)</code></p>

<pre><code class="cpp">// ZEND_BEGIN_ARG_INFO_EX(name, _unused, return_reference, required_num_args)
ZEND_BEGIN_ARG_INFO_EX(arginfo_middleware_call, 0, 0, 2)
    ZEND_ARG_INFO(0, environment)
    ZEND_ARG_INFO(0, response)
ZEND_END_ARG_INFO()
</code></pre>

<p>The code below presents: <code>(array &amp; $environment, array $response)</code></p>

<pre><code class="cpp">ZEND_BEGIN_ARG_INFO_EX(arginfo_middleware_call, 0, 0, 2)
    // ZEND_ARG_ARRAY_INFO(pass_by_ref, name, allow_null)
    ZEND_ARG_ARRAY_INFO(1, environment, 0)
    ZEND_ARG_ARRAY_INFO(0, response, 0)
ZEND_END_ARG_INFO()
</code></pre>

        </div>
            </article>
    <article>
        <header>
            <h2><a href="https://c9s.github.io/extbook/parse-callable-parameter">Parse Callable Parameter</a></h2>
        </header>
        <div>
            <p>The code below is from php-src (<code>ext/standard/basic_functions.c</code>)</p>

<pre><code class="c">    zval *retval_ptr = NULL;
    zend_fcall_info fci;
    zend_fcall_info_cache fci_cache;

    if (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, "f*", &amp;fci, &amp;fci_cache, &amp;fci.params, &amp;fci.param_count) == FAILURE) {
        return;
    }

    fci.retval_ptr_ptr = &amp;retval_ptr;

    if (zend_call_function(&amp;fci, &amp;fci_cache TSRMLS_CC) == SUCCESS &amp;&amp; fci.retval_ptr_ptr &amp;&amp; *fci.retval_ptr_ptr) {
        COPY_PZVAL_TO_ZVAL(*return_value, *fci.retval_ptr_ptr);
    }

    if (fci.params) {
        efree(fci.params);
    }
</code></pre>

        </div>
            </article>
    <nav>
        <br />
        <a href="https://c9s.github.io/extbook/page/2">Older Posts</a><br />
    </nav>
                    
                </div>

                <div class="col-md-3 sidebar">

                    <h3>
                        <a href="https://c9s.github.io/extbook/">PHP Extension Book</a>
                    </h3>

                    <ul class="list-unstyled">
                        <li><a href="https://c9s.github.io/extbook/blog/categories">Categories</a></li>
                        <li><a href="https://c9s.github.io/extbook/blog/tags">Tags</a></li>
                        <li><a href="https://c9s.github.io/extbook/blog">Posts Archive</a></li>
                        <li><a href="https://c9s.github.io/extbook/about">About</a></li>
                    </ul>


                    <h4>Recent Posts</h4>

                    <ul class="list-unstyled">
                                                    <li><a href="/args-info-object">Defining ARG_INFO for object parameters</a></li>
                                                    <li><a href="/args-info">Defining ARG_INFO</a></li>
                                                    <li><a href="/parse-callable-parameter">Parse Callable Parameter</a></li>
                                                    <li><a href="/call-user-function">calling user functions</a></li>
                                                    <li><a href="/invalid-library">Extension Skeleton</a></li>
                                                    <li><a href="/extension-skeleton">Extension Skeleton</a></li>
                                            </ul>
                </div>

            </div>

            <div class="well">
                <h3>PHP Extension Book <small>Extension Cookbook!</small></h3>
            </div>

            <div class="well">
                                <h4>Powered By</h4>
                <ul class="list-unstyled">
                    <li><a href="http://sculpin.io">sculpin.io</a></li>
                    <li><a href="http://twitter.com/getsculpin">@getsculpin</a></li>
                </ul>
            </div>

            <footer>
                &copy; 2015 PHP Extension Book
            </footer>
        </div>


        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="https://c9s.github.io/extbook/components/jquery/jquery.min.js"><\/script>')</script>
                
                <script src="https://c9s.github.io/extbook/components/highlightjs/highlight.pack.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>

                    </body>
</html>
