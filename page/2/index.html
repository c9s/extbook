<!DOCTYPE html>
<html>
    <head>
        <title>Home &mdash; PHP Extension Book &mdash; Extension Cookbook!</title>
        <meta charset="utf-8">
        <meta name="theme-color" content="#ffffff">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <meta name="robots" content="noindex, follow">
        

        
        <link href="https://c9s.github.io/extbook/stylesheets/style.css" rel="stylesheet" type="text/css" />
        <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
        <!--[if lt IE 9]>
            <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">

        <link rel="stylesheet" href="https://c9s.github.io/extbook/components/highlightjs/styles/github.css" />
        <link rel="alternate" type="application/atom+xml" href="https://c9s.github.io/extbook/atom.xml" title="PHP Extension Book activity feed" />
        <style>
        /** quick fix because bootstrap <pre> has a background-color. */
        pre code { background-color: inherit; }

        </style>
                                    </head>
    <body>

        <div class="container">

            <div class="row">

                <div class="col-md-9">

                                            <article>
        <header>
            <h2><a href="https://c9s.github.io/extbook/invalid-library">Extension Skeleton</a></h2>
        </header>
        <div>
            <p>If you encountered this error while running <code>make test</code> or loading extension:</p>

<pre><code>PHP Warning:  PHP Startup: Invalid library (maybe not a PHP library) 'phpsgi.so' in Unknown on line 0
</code></pre>

<p>Be sure to check you defined this:</p>

<pre><code class="c">#if COMPILE_DL_FOO
ZEND_GET_MODULE(foo)
#endif
</code></pre>

        </div>
            </article>
    <article>
        <header>
            <h2><a href="https://c9s.github.io/extbook/extension-skeleton">Extension Skeleton</a></h2>
        </header>
        <div>
            <p>To create an extension, you will need at least three files:</p>

<ul>
<li><code>config.m4</code></li>
<li><code>ext_foo.c</code></li>
<li><code>ext_foo.h</code></li>
</ul>

<p>Here is a initial content of <code>config.m4</code>:</p>

<pre><code class="m4">PHP_ARG_ENABLE(foo, whether to enable foo extension support,
  [--enable-foo Enable foo extension support])
PHP_NEW_EXTENSION(foo, php_foo.c, $ext_shared)
</code></pre>

<p>here is the content of <code>php_foo.h</code>:</p>

<pre><code class="c">#ifndef _PHP_FOO_H
#define _PHP_FOO_H
#ifdef HAVE_CONFIG_H
    #include "config.h"
#endif

#ifdef ZTS
    #warning php_ext_uv module will *NEVER* be thread-safe
    #include &lt;TSRM.h&gt;
#endif

#include &lt;php.h&gt;

extern zend_module_entry foo_module_entry;

PHP_FUNCTION(foo_hello);

#endif
</code></pre>

<p>Here is the content of <code>php_foo.c</code>, a minimal extension source code must contains a <code>zend_module_entry</code>,
And you usually need to define <code>zend_function_entry</code> to declare your extension functions:</p>

<pre><code class="c">#include "php_foo.h"

PHP_MINIT_FUNCTION(foo);
PHP_MSHUTDOWN_FUNCTION(foo);
PHP_MINFO_FUNCTION(foo);

#if COMPILE_DL_FOO
ZEND_GET_MODULE(foo)
#endif

static const zend_function_entry foo_functions[] = {
    PHP_FE(foo_hello, NULL)
    PHP_FE_END
};

zend_module_entry foo_module_entry = {
#if ZEND_MODULE_API_NO &gt;= 20010901
    STANDARD_MODULE_HEADER,
#endif
    "Foo",
    foo_functions, // where you define your functions
    PHP_MINIT(foo),
    PHP_MSHUTDOWN(foo),
    NULL, // PHP_RINIT(foo)
    NULL, // PHP_RSHUTDOWN(foo)
    PHP_MINFO(foo),
#if ZEND_MODULE_API_NO &gt;= 20010901
    "0.1",
#endif
    STANDARD_MODULE_PROPERTIES
};

PHP_MINIT_FUNCTION(foo) {
    return SUCCESS;
}

PHP_MSHUTDOWN_FUNCTION(foo) {
    return SUCCESS;
}

PHP_MINFO_FUNCTION(foo) {
}

PHP_FUNCTION(foo_hello) {
    RETURN_TRUE;
}

</code></pre>

<p>Compile it!</p>

<pre><code class="sh">phpize
./configure
make
</code></pre>

        </div>
            </article>
    <nav>
        <a href="https://c9s.github.io/extbook/">Newer Posts</a><br />
        <br />
    </nav>
                    
                </div>

                <div class="col-md-3 sidebar">

                    <h3>
                        <a href="https://c9s.github.io/extbook/">PHP Extension Book</a>
                    </h3>

                    <ul class="list-unstyled">
                        <li><a href="https://c9s.github.io/extbook/blog/categories">Categories</a></li>
                        <li><a href="https://c9s.github.io/extbook/blog/tags">Tags</a></li>
                        <li><a href="https://c9s.github.io/extbook/blog">Posts Archive</a></li>
                        <li><a href="https://c9s.github.io/extbook/about">About</a></li>
                    </ul>


                    <h4>Recent Posts</h4>

                    <ul class="list-unstyled">
                                                    <li><a href="/args-info">Defining ARG_INFO</a></li>
                                                    <li><a href="/parse-callable-parameter">Parse Callable Parameter</a></li>
                                                    <li><a href="/call-user-function">call_user_function_ex</a></li>
                                                    <li><a href="/invalid-library">Extension Skeleton</a></li>
                                                    <li><a href="/extension-skeleton">Extension Skeleton</a></li>
                                            </ul>
                </div>

            </div>

            <div class="well">
                <h3>PHP Extension Book <small>Extension Cookbook!</small></h3>
            </div>

            <div class="well">
                                <h4>Powered By</h4>
                <ul class="list-unstyled">
                    <li><a href="http://sculpin.io">sculpin.io</a></li>
                    <li><a href="http://twitter.com/getsculpin">@getsculpin</a></li>
                </ul>
            </div>

            <footer>
                &copy; 2015 PHP Extension Book
            </footer>
        </div>


        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="https://c9s.github.io/extbook/components/jquery/jquery.min.js"><\/script>')</script>
                
                <script src="https://c9s.github.io/extbook/components/highlightjs/highlight.pack.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>

                    </body>
</html>
