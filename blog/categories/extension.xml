<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <title><![CDATA[PHP Extension Book]]></title>
    <link href="https://c9s.github.io/extbook/blog/categories/extension.xml" rel="self"/>
    <link href="https://c9s.github.io/extbook/"/>
    <updated>2015-09-15T17:06:53+08:00</updated>
    <id>https://c9s.github.io/extbook/</id>
        <generator uri="http://sculpin.io/">Sculpin</generator>
            <entry>
            <title type="html"><![CDATA[Extension Skeleton]]></title>
            <link href="https://c9s.github.io/extbook/extension-skeleton"/>
            <updated>2015-09-01T00:00:00+08:00</updated>
            <id>https://c9s.github.io/extbook/extension-skeleton</id>
            <content type="html"><![CDATA[<p>To create an extension, you will need at least three files:</p>

<ul>
<li><code>config.m4</code></li>
<li><code>ext_foo.c</code></li>
<li><code>ext_foo.h</code></li>
</ul>

<p>Here is a initial content of <code>config.m4</code>:</p>

<pre><code class="m4">PHP_ARG_ENABLE(foo, whether to enable foo extension support,
  [--enable-foo Enable foo extension support])
PHP_NEW_EXTENSION(foo, php_foo.c, $ext_shared)
</code></pre>

<p>here is the content of <code>php_foo.h</code>:</p>

<pre><code class="c">#ifndef _PHP_FOO_H
#define _PHP_FOO_H
#ifdef HAVE_CONFIG_H
    #include "config.h"
#endif

#ifdef ZTS
    #warning php_ext_uv module will *NEVER* be thread-safe
    #include &lt;TSRM.h&gt;
#endif

#include &lt;php.h&gt;

extern zend_module_entry foo_module_entry;

PHP_FUNCTION(foo_hello);

#endif
</code></pre>

<p>Here is the content of <code>php_foo.c</code>, a minimal extension source code must contains a <code>zend_module_entry</code>,
And you usually need to define <code>zend_function_entry</code> to declare your extension functions:</p>

<pre><code class="c">#include "php_foo.h"

PHP_MINIT_FUNCTION(foo);
PHP_MSHUTDOWN_FUNCTION(foo);
PHP_MINFO_FUNCTION(foo);

#if COMPILE_DL_FOO
ZEND_GET_MODULE(foo)
#endif

static const zend_function_entry foo_functions[] = {
    PHP_FE(foo_hello, NULL)
    PHP_FE_END
};

zend_module_entry foo_module_entry = {
#if ZEND_MODULE_API_NO &gt;= 20010901
    STANDARD_MODULE_HEADER,
#endif
    "Foo",
    foo_functions, // where you define your functions
    PHP_MINIT(foo),
    PHP_MSHUTDOWN(foo),
    NULL, // PHP_RINIT(foo)
    NULL, // PHP_RSHUTDOWN(foo)
    PHP_MINFO(foo),
#if ZEND_MODULE_API_NO &gt;= 20010901
    "0.1",
#endif
    STANDARD_MODULE_PROPERTIES
};

PHP_MINIT_FUNCTION(foo) {
    return SUCCESS;
}

PHP_MSHUTDOWN_FUNCTION(foo) {
    return SUCCESS;
}

PHP_MINFO_FUNCTION(foo) {
}

PHP_FUNCTION(foo_hello) {
    RETURN_TRUE;
}

</code></pre>

<p>Compile it!</p>

<pre><code class="sh">phpize
./configure
make
</code></pre>
]]></content>
        </entry>
    </feed>